<!DOCTYPE html>
<html lang="tr">

<! -- header.html -->
<meta charset="utf-8">
<title>我的文字</title>

<meta name="author" content="xuzou">

<!-- Enable responsive viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
 <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- Le styles -->
<link href="http://www.xuzou.me/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="http://www.xuzou.me/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="http://www.xuzou.me/assets/resources/syntax/syntax.css" rel="stylesheet">
<link href="http://www.xuzou.me/assets/css/style.css" rel="stylesheet">

<!-- Le fav and touch icons -->
<!-- Update these with your own images
<link rel="shortcut icon" href="images/favicon.ico">
<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
-->

 <link rel="alternate" type="application/rss+xml" title="" href="http://www.xuzou.me/feed.xml">

<! -- header.html end -->


   <body>
   		<nav class="navbar navbar-default visible-xs" role="navigation">
		  <!-- Brand and toggle get grouped for better mobile display -->
		  <div class="navbar-header">
		    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
			  <span class="sr-only">Toggle navigation</span>
			  <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/august-zou">
		      <i class="fa fa-github"></i>
		    </a>
		    
		    
		    <a type="button" class="navbar-toggle nav-link" href="http://twitter.com/augustzou">
		      <i class="fa fa-twitter"></i>
		    </a>
		    
		    
		    <a type="button" class="navbar-toggle nav-link" href="mailto:zjzouxu@gmail.com">
		      <i class="fa fa-envelope"></i>
		    </a>
		    
			<a class="navbar-brand" href="http://www.xuzou.me/">
				<img src="http://www.gravatar.com/avatar/58155757e0bb79f6bb85f28854a5c3b0?s=35" class="img-circle" />
				我的一点点
			</a>
		  </div>

		  <!-- Collect the nav links, forms, and other content for toggling -->
		  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
			  <li class="active"><a href="http://www.xuzou.me/">首页</a></li>
        <li><a href="http://www.xuzou.me/about.html"> 关于</a></li>
			  <li><a href="http://www.xuzou.me/categories.html">归档</a></li>
  			  <li><a href="http://www.xuzou.me/tags.html">标签</a></li>
			</ul>
		  </div><!-- /.navbar-collapse -->
		</nav>

       <!-- nav-menu-dropdown -->
       <div class="btn-group hidden-xs" id="nav-menu">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-bars"></i>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li><a href="http://www.xuzou.me/"><i class="fa fa-home"></i> 首页</a></li>
            <li><a href="http://www.xuzou.me/about.html"><i class="fa fa-user"></i> 关于</a></li>
            <li><a href="http://www.xuzou.me/categories.html"><i class="fa fa-folder"></i> 归档</a></li>
            <li><a href="http://www.xuzou.me/tags.html"><i class="fa fa-tags"></i> 标签</a></li>
              <li class="divider"></li>
            <li><a href="#"><i class="fa fa-arrow-up"></i> 页首</a></li>
          </ul>
       </div>

		<div class="col-sm-3 sidebar hidden-xs">
			<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="http://www.xuzou.me/">
		<img src="http://www.gravatar.com/avatar/58155757e0bb79f6bb85f28854a5c3b0?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="http://www.xuzou.me/">我的一点点</a>
    </h3>
</header>


<div id="bio" class="text-center">
	思考一点点，写下一点点，就会多一点点!
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/august-zou">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="http://weibo.com/xuzou">
				<i class="fa fa-weibo fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:zjzouxu@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>

	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/augustzou">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		
		<li>
			<a class="btn btn-default btn-sm" href="http://www.xuzou.me/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>

	

<! -- sidebar.html end -->

		</div>

		<div class="col-sm-9 col-sm-offset-3">
			<div class="page-header">
  <h1>我的文字 </h1>
</div>



        <article class="home">

            <span class="post-date">
                
                April
                5th,
                
                2014
            </span>

            <h2>
                <a href="http://www.xuzou.me/coding/ruby/2014/04/05/seven-patterns-to-refactor-fat-activerecord-models.html">Seven Patterns to Refactor Fat ActiveRecord Models(转载)</a>
            </h2>

            <div>
                
                  <p><a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">原文</a></p>

<p>When teams use Code Climate to improve the quality of their Rails applications, they learn to break the habit of allowing models to get fat. “Fat models” cause maintenance issues in large apps. Only incrementally better than cluttering controllers with domain logic, they usually represent a failure to apply the Single Responsibility Principle (SRP). “Anything related to what a user does” is not a single responsibility.</p>

<p>Early on, SRP is easier to apply. ActiveRecord classes handle persistence, associations and not much else. But bit-by-bit, they grow. Objects that are inherently responsible for persistence become the de facto owner of all business logic as well. And a year or two later you have a User class with over 500 lines of code, and hundreds of methods in it’s public interface. Callback hell ensues.</p>

<p>As you add more intrinsic complexity (read: features!) to your application, the goal is to spread it across a coordinated set of small, encapsulated objects (and, at a higher level, modules) just as you might spread cake batter across the bottom of a pan. Fat models are like the big clumps you get when you first pour the batter in. Refactor to break them down and spread out the logic evenly. Repeat this process and you’ll end up with a set of simple objects with well defined interfaces working together in a veritable symphony.</p>

<p>You may be thinking:</p>

<p><code>“But Rails makes it really hard to do OOP right!”</code></p>

<p>I used to believe that too. But after some exploration and practice, I realized that Rails (the framework) doesn’t impede OOP all that much. It’s the Rails “conventions” that don’t scale, or, more specifically, the lack of conventions for managing complexity beyond what the Active Record pattern can elegantly handle. Fortunately, we can apply OO-based principles and best practices where Rails is lacking.</p>

<p>Don’t Extract Mixins from Fat Models</p>

<p>Let’s get this out of the way. I discourage pulling sets of methods out of a large ActiveRecord class into “concerns”, or modules that are then mixed in to only one model. I once heard someone say:</p>

<p><code>“Any application with an app/concerns directory is concerning.”</code></p>

<p>And I agree. Prefer composition to inheritance. Using mixins like this is akin to “cleaning” a messy room by dumping the clutter into six separate junk drawers and slamming them shut. Sure, it looks cleaner at the surface, but the junk drawers actually make it harder to identify and implement the decompositions and extractions necessary to clarify the domain model.</p>

<p>Now on to the refactorings!</p>

<h2 id="1_extract_value_objects">1. Extract Value Objects</h2>

<p>Value Objects are simple objects whose equality is dependent on their value rather than an identity. They are usually immutable. Date, URI, and Pathname are examples from Ruby’s standard library, but your application can (and almost certainly should) define domain-specific Value Objects as well. Extracting them from ActiveRecords is low hanging refactoring fruit.</p>

<p>In Rails, Value Objects are great when you have an attribute or small group of attributes that have logic associated with them. Anything more than basic text fields and counters are candidates for Value Object extraction.</p>

<p>For example, a text messaging application I worked on had a PhoneNumber Value Object. An e-commerce application needs a Money class. Code Climate has a Value Object named Rating that represents a simple A - F grade that each class or module receives. I could (and originally did) use an instance of a Ruby String, but Rating allows me to combine behavior with the data:</p>

<pre><code>class Rating
  include Comparable

  def self.from_cost(cost)
    if cost &lt;= 2
      new(&quot;A&quot;)
    elsif cost &lt;= 4
      new(&quot;B&quot;)
    elsif cost &lt;= 8
      new(&quot;C&quot;)
    elsif cost &lt;= 16
      new(&quot;D&quot;)
    else
      new(&quot;F&quot;)
    end
  end

  def initialize(letter)
    @letter = letter
  end

  def better_than?(other)
    self &gt; other
  end

  def &lt;=&gt;(other)
    other.to_s &lt;=&gt; to_s
  end

  def hash
    @letter.hash
  end

  def eql?(other)
    to_s == other.to_s
  end

  def to_s
    @letter.to_s
  end
end</code></pre>

<p>Every ConstantSnapshot then exposes an instance of Rating in its public interface:</p>

<pre><code>class ConstantSnapshot &lt; ActiveRecord::Base
  # …

  def rating
    @rating ||= Rating.from_cost(cost)
  end
end</code></pre>

<p>Beyond slimming down the ConstantSnapshot class, this has a number of advantages:</p>

<p>The #worse_than? and #better_than? methods provide a more expressive way to compare ratings than Ruby’s built-in operators (e.g. &lt; and &gt;). Defining #hash and #eql? makes it possible to use a Rating as a hash key. Code Climate uses this to idiomatically group constants by their ratings using Enumberable#group_by. The #to_s method allows me to interpolate a Rating into a string (or template) without any extra work. The class definition provides a convenient place for a factory method, returning the correct Rating for a given “remediation cost” (the estimated time it would take to fix all of the smells in a given class).</p>

<h2 id="2_extract_service_objects">2. Extract Service Objects</h2>

<p>Some actions in a system warrant a Service Object to encapsulate their operation. I reach for Service Objects when an action meets one or more of these criteria:</p>

<p>The action is complex (e.g. closing the books at the end of an accounting period) The action reaches across multiple models (e.g. an e-commerce purchase using Order, CreditCard and Customer objects) The action interacts with an external service (e.g. posting to social networks) The action is not a core concern of the underlying model (e.g. sweeping up outdated data after a certain time period). There are multiple ways of performing the action (e.g. authenticating with an access token or password). This is the Gang of Four Strategy pattern. As an example, we could pull a User#authenticate method out into a UserAuthenticator:</p>

<pre><code>class UserAuthenticator
  def initialize(user)
    @user = user
  end

  def authenticate(unencrypted_password)
    return false unless @user

    if BCrypt::Password.new(@user.password_digest) == unencrypted_password
      @user
    else
      false
    end
  end
end</code></pre>

<p>And the SessionsController would look like this:</p>

<p>class SessionsController &lt; ApplicationController def create user = User.where(email: params[:email]).first</p>

<pre><code>if UserAuthenticator.new(user).authenticate(params[:password])
  self.current_user = user
  redirect_to dashboard_path
else
  flash[:alert] = &quot;Login failed.&quot;
  render &quot;new&quot;
end</code></pre>

<p>end end</p>

<h2 id="3_extract_form_objects">3. Extract Form Objects</h2>

<p>When multiple ActiveRecord models might be updated by a single form submission, a Form Object can encapsulate the aggregation. This is far cleaner than using accepts_nested_attributes_for, which, in my humble opinion, should be deprecated. A common example would be a signup form that results in the creation of both a Company and a User:</p>

<pre><code>class Signup
  include Virtus

  extend ActiveModel::Naming
  include ActiveModel::Conversion
  include ActiveModel::Validations

  attr_reader :user
  attr_reader :company

  attribute :name, String
  attribute :company_name, String
  attribute :email, String

  validates :email, presence: true
  # … more validations …

  # Forms are never themselves persisted
  def persisted?
    false
  end

  def save
    if valid?
      persist!
      true
    else
      false
    end
  end

private

  def persist!
    @company = Company.create!(name: company_name)
    @user = @company.users.create!(name: name, email: email)
  end
end</code></pre>

<p>I’ve started using Virtus in these objects to get ActiveRecord-like attribute functionality. The Form Object quacks like an ActiveRecord, so the controller remains familiar:</p>

<p>class SignupsController &lt; ApplicationController def create @signup = Signup.new(params[:signup])</p>

<pre><code>if @signup.save
  redirect_to dashboard_path
else
  render &quot;new&quot;
end</code></pre>

<p>end end This works well for simple cases like the above, but if the persistence logic in the form gets too complex you can combine this approach with a Service Object. As a bonus, since validation logic is often contextual, it can be defined in the place exactly where it matters instead of needing to guard validations in the ActiveRecord itself.</p>

<h2 id="4_extract_query_objects">4. Extract Query Objects</h2>

<p>For complex SQL queries littering the definition of your ActiveRecord subclass (either as scopes or class methods), consider extracting query objects. Each query object is responsible for returning a result set based on business rules. For example, a Query Object to find abandoned trials might look like this:</p>

<p>class AbandonedTrialQuery def initialize(relation = Account.scoped) @relation = relation end</p>

<p>def find_each(&amp;block) @relation. where(plan: nil, invites_count: 0). find_each(&amp;block) end end You might use it in a background job to send emails:</p>

<p>AbandonedTrialQuery.new.find_each do |account| account.send_offer_for_support end Since ActiveRecord::Relation instances are first class citizens as of Rails 3, they make a great input to a Query Object. This allows you to combine queries using composition:</p>

<p>old_accounts = Account.where(“created_at &lt; ?”, 1.month.ago) old_abandoned_trials = AbandonedTrialQuery.new(old_accounts) Don’t bother testing a class like this in isolation. Use tests that exercise the object and the database together to ensure the correct rows are returned in the right order and any joins or eager loads are performed (e.g. to avoid N + 1 query bugs).</p>

<h2 id="5_introduce_view_objects">5. Introduce View Objects</h2>

<p>If logic is needed purely for display purposes, it does not belong in the model. Ask yourself, “If I was implementing an alternative interface to this application, like a voice-activated UI, would I need this?”. If not, consider putting it in a helper or (often better) a View object.</p>

<p>For example, the donut charts in Code Climate break down class ratings based on a snapshot of the codebase (e.g. Rails on Code Climate) and are encapsulated as a View:</p>

<pre><code>class DonutChart
  def initialize(snapshot)
    @snapshot = snapshot
  end

  def cache_key
    @snapshot.id.to_s
  end

  def data
    # pull data from @snapshot and turn it into a JSON structure
  end
end</code></pre>

<p>I often find a one-to-one relationship between Views and ERB (or Haml/Slim) templates. This has led me to start investigating implementations of the Two Step View pattern that can be used with Rails, but I don’t have a clear solution yet.</p>

<p>Note: The term “Presenter” has caught on in the Ruby community, but I avoid it for its baggage and conflicting use. The “Presenter” term was introduced by Jay Fields to describe what I refer to above as “Form Objects”. Also, Rails unfortunately uses the term “view” to describe what are otherwise known as “templates”. To avoid ambiguity, I sometimes refer to these View objects as “View Models”.</p>

<h2 id="6_extract_policy_objects">6. Extract Policy Objects</h2>

<p>Sometimes complex read operations might deserve their own objects. In these cases I reach for a Policy Object. This allows you to keep tangential logic, like which users are considered active for analytics purposes, out of your core domain objects. For example:</p>

<pre><code>class ActiveUserPolicy
  def initialize(user)
    @user = user
  end

  def active?
    @user.email_confirmed? &amp;&amp;
    @user.last_login_at &gt; 14.days.ago
  end
end</code></pre>

<p>This Policy Object encapsulates one business rule, that a user is considered active if they have a confirmed email address and have logged in within the last two weeks. You can also use Policy Objects for a group of business rules like an Authorizer that regulates which data a user can access.</p>

<p>Policy Objects are similar to Service Objects, but I use the term “Service Object” for write operations and “Policy Object” for reads. They are also similar to Query Objects, but Query Objects focus on executing SQL to return a result set, whereas Policy Objects operate on domain models already loaded into memory.</p>

<h2 id="7_extract_decorators">7. Extract Decorators</h2>

<p>Decorators let you layer on functionality to existing operations, and therefore serve a similar purpose to callbacks. For cases where callback logic only needs to run in some circumstances or including it in the model would give the model too many responsibilities, a Decorator is useful.</p>

<p>Posting a comment on a blog post might trigger a post to someone’s Facebook wall, but that doesn’t mean the logic should be hard wired into the Comment class. One sign you’ve added too many responsibilities in callbacks is slow and brittle tests or an urge to stub out side effects in wholly unrelated test cases.</p>

<p>Here’s how you might extract Facebook posting logic into a Decorator:</p>

<pre><code>class FacebookCommentNotifier
  def initialize(comment)
    @comment = comment
  end

  def save
    @comment.save &amp;&amp; post_to_wall
  end

private

  def post_to_wall
    Facebook.post(title: @comment.title, user: @comment.author)
  end
end
And how a controller might use it:

class CommentsController &lt; ApplicationController
  def create
    @comment = FacebookCommentNotifier.new(Comment.new(params[:comment]))

    if @comment.save
      redirect_to blog_path, notice: &quot;Your comment was posted.&quot;
    else
      render &quot;new&quot;
    end
  end
end</code></pre>

<p>Decorators differ from Service Objects because they layer on responsibilities to existing interfaces. Once decorated, collaborators just treat the FacebookCommentNotifier instance as if it were a Comment. In its standard library, Ruby provides a number of facilities to make building decorators easier with metaprogramming.</p>

<p>Wrapping Up</p>

<p>Even in a Rails application, there are many tools to manage complexity in the model layer. None of them require you to throw out Rails. ActiveRecord is a fantastic library, but any pattern breaks down if you depend on it exclusively. Try limiting your ActiveRecords to persistence behavior. Sprinkle in some of these techniques to spread out the logic in your domain model and the result will be a much more maintainable application.</p>

<p>You’ll also note that many of the patterns described here are quite simple. The objects are just “Plain Old Ruby Objects” (PORO) used in different ways. And that’s part of the point and the beauty of OOP. Every problem doesn’t need to be solved by a framework or library, and naming matters a great deal.</p>

<p>What do you think of the seven techniques I presented above? What are your favorites and why? Have I missed any? Let me know in the comments!</p>

<p>P.S. If you found this post useful, you may want to subscribe to our email newsletter (see below). It’s low volume, and includes content about OOP and refactoring Rails applications like this.</p>
                
            </div>

        </article>


        <article class="home">

            <span class="post-date">
                
                March
                10th,
                
                2014
            </span>

            <h2>
                <a href="http://www.xuzou.me/coding/ruby/2014/03/10/ruby-styleguide.html">【译】Ruby编码规范</a>
            </h2>

            <div>
                
                  <p>本文档翻译与<a href="https://github.com/styleguide/ruby">Github ruby-style-guide</a> <br />本文档是GitHub内部使用的Ruby规范编码规范。原文档参考了<a href="https://github.com/bbatsov/ruby-style-guide">ruby-style-guid</a></p>

<h2 id="">编码风格</h2>
<hr />
<ul>
<li>
<p>使用空格符进行代码的缩进，而不是使用Tab</p>
</li>

<li>
<p>每行代码少于80个字符</p>
</li>

<li>
<p>不要再一行的后面留有空格</p>
</li>

<li>
<p>每个文件留一空行</p>
</li>

<li>
<p>操作符之后留一个空格，在逗号、冒号、大括号之后留空格</p>

<pre><code>sum = 1 + 2   
	a, b = 1, 2    
1 &gt; 2 ? true : false; puts &quot;Hi&quot;    
[1, 2, 3].each { |e| puts e } </code></pre>
</li>

<li>
<p>不要在<code>(, [ 和 ], )</code>符号之前留空格</p>

<pre><code>some(arg).other
[1, 2, 3].length</code></pre>
</li>

<li>
<p>在<code> ! </code>空格前不要留空格</p>

<pre><code>!array.include?(element)</code></pre>
</li>

<li>
<p>缩进 <code>case...when...</code></p>

<pre><code>case
when song.name == &quot;Misty&quot;
  puts &quot;Not again!&quot;
when song.duration &gt; 120
  puts &quot;Too long!&quot;
when Time.now.hour &gt; 21
  puts &quot;It&#39;s too late&quot;
else
  song.play
end

kind = case year
       when 1850..1889 then &quot;Blues&quot;
       when 1890..1909 then &quot;Ragtime&quot;
       when 1910..1929 then &quot;New Orleans Jazz&quot;
       when 1930..1939 then &quot;Swing&quot;
       when 1940..1950 then &quot;Bebop&quot;
       else &quot;Jazz&quot;
       end</code></pre>
</li>

<li>
<p>在两个方法之间插入一空行，每个方法内通过空行来归约逻辑关系</p>

<pre><code>  def some_method
    data = initialize(options)

    data.manipulate!

    data.result
  end

  def some_method
    result
  end</code></pre>
</li>
</ul>

<h2 id="_2">文档</h2>
<hr />
<p>使用<a href="http://tomdoc.org/">TomDoc</a>规范注释文档格式，其格式大致如下：</p>

<pre><code>	# Public: Duplicate some text an arbitrary number of times.
	#
	# text  - The String to be duplicated.
	# count - The Integer number of times to duplicate the text.
	#
	# Examples
	#
	#   multiplex(&quot;Tom&quot;, 4)
	#   # =&gt; &quot;TomTomTomTom&quot;
	#
	# Returns the duplicated String.
	def multiplex(text, count)
	  text * count
	end</code></pre>

<h2 id="_3">代码排版约定</h2>
<hr />
<ul>
<li>
<p>定义方法时，无参数时省略圆括号，当有参数时需要加圆括号，如：</p>

<pre><code>   def some_method
     # body omitted
   end

   def some_method_with_arguments(arg1, arg2)
     # body omitted
   end</code></pre>
</li>

<li>
<p>不要使用for语句，除非你确定for语句优于迭代方案。请使用each,each方法中会使用for.注意：for语句并不会重新定义一个作用域，在其中定义的变量，在其外部依然可见。</p>

<pre><code>  arr = [1, 2, 3]

  # bad
  for elem in arr do
    puts elem
  end

  # good
  arr.each { |elem| puts elem }</code></pre>
</li>

<li>
<p>对于多行<code>if/uless</code>不要使用<code>then</code></p>

<pre><code> # bad
if some_condition then
  # body omitted
end

# good
if some_condition
  # body omitted
end</code></pre>
</li>

<li>
<p>除非其他表达式太过于繁琐，尽量避免使用三元表达式（<code>?:</code>）。当时用（if/then/else/end）这种结构，并在单行出现时，请使用（<code>?:</code>）</p>

<pre><code>  # bad
  result = if some_condition then something else something_else end

  # good
  result = some_condition ? something : something_else</code></pre>
</li>

<li>
<p>使用三元表达式时，请勿嵌套使用</p>

<pre><code>  # bad
  some_condition ? (nested_condition ? nested_something : nested_something_else) : something_else

  # good
  if some_condition
    nested_condition ? nested_something : nested_something_else
  else
    something_else
  end</code></pre>
</li>

<li>
<p>不提倡使用ruby中<code>and</code> 和 <code>or</code> 关键字，永远使用<code>&amp;&amp;</code>和<code>||</code></p>
</li>

<li>
<p>在单行中有条件判断语句时，请使用<code>if/unless</code></p>

<pre><code>  # bad
  if some_condition
    do_something
  end

  # good
  do_something if some_condition</code></pre>
</li>

<li>
<p><strong>永远不要</strong>出现<code>unless</code>和<code>else</code> 共同使用 # bad unless success? puts “failure” else puts “success” end</p>

<pre><code># good
if success?
  puts &quot;success&quot;
else
  puts &quot;failure&quot;
 end</code></pre>
</li>

<li>
<p>在 <code>if/unless/while</code>的条件判断语句之后，判断表达式不要使用圆括号</p>

<pre><code># bad
if (x &gt; 10)
  # body omitted
end

# good
if x &gt; 10
  # body omitted
end</code></pre>
</li>

<li>
<p>在单行块中使用<code>{...}</code>。<strong>永远不要</strong>在多行中使用<code>{...}</code>，而是使用<code>do...end</code>。在调用链中不要使用<code>do...end</code></p>

<pre><code>names = [&quot;Bozhidar&quot;, &quot;Steve&quot;, &quot;Sarah&quot;]

# good
names.each { |name| puts name }

# bad
names.each do |name|
  puts name
end

# good
names.select { |name| name.start_with?(&quot;S&quot;) }.map { |name| name.upcase }

# bad
names.select do |name|
  name.start_with?(&quot;S&quot;)
end.map { |name| name.upcase }</code></pre>
</li>

<li>
<p>避免使用不必要的<code>return</code></p>

<pre><code># bad
def some_method(some_arr)
  return some_arr.size
end

# good
def some_method(some_arr)
  some_arr.size
end</code></pre>
</li>

<li>
<p>当为方法的参数赋默认值时，在<code>=</code>号前后添加空格</p>

<pre><code># bad
def some_method(arg1=:default, arg2=nil, arg3=[])
  # do something...
end

# good
def some_method(arg1 = :default, arg2 = nil, arg3 = [])
  # do something...
end</code></pre>
</li>

<li>
<p>可以对使用返回值进行赋值</p>

<pre><code># bad
if (v = array.grep(/foo/)) ...

# good
if v = array.grep(/foo/) ...

# also good - has correct precedence.
if (v = next_value) == &quot;hello&quot; ...</code></pre>
</li>

<li>
<p>在可以的时候尽量使用<code>||=</code>进行变量的初始化</p>

<pre><code># set name to Bozhidar, only if it&#39;s nil or false
name ||= &quot;Bozhidar&quot;</code></pre>
</li>

<li>
<p><strong>永远不要</strong>使用<code>||=</code>初始赋值布尔类型变量</p>

<pre><code># bad - would set enabled to true even if it was false
enabled ||= true

# good
enabled = true if enabled.nil?</code></pre>
</li>

<li>
<p>避免使用Perl风格的变量命名（如$0-9,$,etc）.这种命名方式过于简单而无意义。请使用有意义的命名发如（$PROGRAM_NAME）。</p>
</li>

<li>
<p><strong>永远不要</strong>再方法名之后添加空格</p>

<pre><code># bad
f (3 + 2) + 1

# good
f(3 + 2) + 1</code></pre>
</li>

<li>
<p>如果方法名称之后是一个圆括号，则在之后都是用括号(如f((3 + 2) + 1))</p>
</li>

<li>
<p>使用<code>_</code>作为块中未使用的参数</p>

<pre><code># bad
result = hash.map { |k, v| v + 1 }

# good
result = hash.map { |_, v| v + 1 }</code></pre>
</li>

<li>
<p><strong>永远不要</strong>使用<code>===</code>判断对象的类型，<code>===</code>只是ruby作为实现如case语句时内部使用的特性方法，如果要判断一个变量的类型，请使用方法<code>is_a?</code>或者<code>kind_of?</code></p>
</li>
</ul>

<h2 id="_4">命名</h2>
<hr />
<ul>
<li>
<p>变量和方法名称使用 <a href="http://blog.lmorchard.com/2013/01/23/naming-conventions">snake_case</a> 蛇底式命名规则</p>
</li>

<li>
<p>类和模块名称使用 <a href="http://searchsoa.techtarget.com/definition/CamelCase">CamelCase</a>驼峰式命名规则</p>
</li>

<li>
<p>常量名称使用 <a href="#">SCREAMING_SNAKE_CASE</a>大写的蛇底式命名规则</p>
</li>

<li>
<p>以<code>?</code>作为询问式方法的结尾(如 <code>Array#empty?</code>)</p>
</li>

<li>
<p>一个危险方法（直接改变<code>self</code>或者参数值的方法），不要在方法名之后加<code>!</code></p>
</li>
</ul>

<h2 id="_5">类</h2>
<hr />
<ul>
<li>
<p>避免使用类变量(@@),因为在类继承链中对类变量的修改会影响他的值</p>

<pre><code>class Parent
  @@class_var = &quot;parent&quot;

  def self.print_class_var
    puts @@class_var
  end
end

class Child &lt; Parent
  @@class_var = &quot;child&quot;
end

Parent.print_class_var # =&gt; will print &quot;child&quot;</code></pre>
</li>

<li>
<p>使用<code>def self.method</code>定义类方法</p>

<pre><code>class TestClass
  # bad
  def TestClass.some_method
    # body omitted
  end

  # good
  def self.some_other_method
    # body omitted
  end</code></pre>
</li>

<li>
<p>当必要时使用 <code>class &lt;&lt; self</code>,如 类属性或别名</p>

<pre><code>class TestClass
  # bad
  class &lt;&lt; self
    def first_method
      # body omitted
    end

    def second_method_etc
      # body omitted
    end
  end

  # good
  class &lt;&lt; self
    attr_accessor :per_page
    alias_method :nwo, :find_by_name_with_owner
  end

  def self.first_method
    # body omitted
  end

  def self.second_method_etc
    # body omitted
  end
end</code></pre>
</li>

<li>
<p>缩进<code>public</code>,<code>protected</code>,<code>private</code>方法，为他们之前的间隔留一空行</p>

<pre><code>class SomeClass
  def public_method
    # ...
  end

  private
  def private_method
    # ...
  end
end</code></pre>
</li>

<li>
<p>除非必须使用<code>self</code>表示内部类或对象消息，其他情况不要使用self</p>

<pre><code>class SomeClass
  attr_accessor :message

  def greeting(name)
    message = &quot;Hi #{name}&quot; # local variable in Ruby, not attribute writer
    self.message = message
  end
end</code></pre>
</li>
</ul>

<h2 id="_6">异常</h2>
<hr />
<ul>
<li>
<p>不要使用异常作为程序流程控制</p>

<pre><code>class SomeClass
  attr_accessor :message

  def greeting(name)
    message = &quot;Hi #{name}&quot; # local variable in Ruby, not attribute writer
    self.message = message
  end
end</code></pre>
</li>

<li>
<p>让异常抛出，而不是处理异常</p>

<pre><code># bad
begin
  # an exception occurs here
rescue
  # exception handling
end

# still bad
begin
  # an exception occurs here
rescue Exception
  # exception handling
end</code></pre>
</li>
</ul>

<h2 id="_7">集合</h2>
<hr />
<ul>
<li>
<p>使用 <code>%w</code> 创建字符串数组</p>

<pre><code># bad
STATES = [&quot;draft&quot;, &quot;open&quot;, &quot;closed&quot;]

# good
STATES = %w(draft open closed)</code></pre>
</li>

<li>
<p>当数组中元素不可重复时，使用<code>Set</code>代替<code>Array</code>,<code>Set</code>实现了一个戊戌无重复元素的集合，是数组和哈希的结合体</p>
</li>

<li>
<p>使用<code>symbols</code>标识符代替字符串作为哈希的键</p>

<pre><code># bad
hash = { &quot;one&quot; =&gt; 1, &quot;two&quot; =&gt; 2, &quot;three&quot; =&gt; 3 }

# good
hash = { :one =&gt; 1, :two =&gt; 2, :three =&gt; 3 }</code></pre>
</li>
</ul>

<h2 id="_8">字符串</h2>
<hr />
<ul>
<li>
<p>使用字符串插入，而不用字符串连接</p>

<pre><code># bad
email_with_name = user.name + &quot; &lt;&quot; + user.email + &quot;&gt;&quot;

# good
email_with_name = &quot;#{user.name} &lt;#{user.email}&gt;&quot;</code></pre>
</li>

<li>
<p>使用双引号<code>&quot;</code>构造字符串对象。字符串插值或转义字符将会在双引号下有效，单引号<code>&#39;</code>往往多在字符串字面量中使用</p>

<pre><code># bad
name = &#39;Bozhidar&#39;

# good
name = &quot;Bozhidar&quot;</code></pre>
</li>

<li>
<p>当需要多次构造长串的字符串时，使用<code>String#&lt;&lt;</code>而不是使用<code>String#+</code>。</p>

<pre><code># good and also fast
html = &quot;&quot;
html &lt;&lt; &quot;&lt;h1&gt;Page title&lt;/h1&gt;&quot;

paragraphs.each do |paragraph|
  html &lt;&lt; &quot;&lt;p&gt;#{paragraph}&lt;/p&gt;&quot;
end</code></pre>
</li>
</ul>

<h2 id="_9">正则表达式</h2>
<hr />
<ul>
<li>
<p>避免使用$1-9,而是使用有意义的命名</p>

<pre><code># bad
/(regexp)/ =~ string
...
process $1

# good
/(?&lt;meaningful_var&gt;regexp)/ =~ string
...
process meaningful_var</code></pre>
</li>

<li>
<p>注意<code>^</code>/<code>$</code>表示了一行的开始和结尾，而不是表示整个字符串的结尾。当要匹配整个字符串时，使用<code>\A</code>和<code>\z</code></p>

<pre><code>string = &quot;some injection\nusername&quot;
string[/^username$/]   # matches
string[/\Ausername\z/] # don&#39;t match</code></pre>
</li>

<li>
<p>使用x来构造复杂的表达式</p>

<pre><code>regexp = %r{
  start         # some text
  \s            # white space char
  (group)       # first group
  (?:alt1|alt2) # some alternation
  end
}x</code></pre>
</li>
</ul>

<h2 id="_10">百分号字面量</h2>
<hr />
<ul>
<li>
<p>尽量使用%w</p>

<pre><code>STATES = %w(draft open closed)</code></pre>
</li>

<li>
<p>使用在单行字符串中需要使用插值和内嵌的双引号时，使用<code>%()</code></p>

<pre><code># bad (no interpolation needed)
%(&lt;div class=&quot;text&quot;&gt;Some text&lt;/div&gt;)
# should be &quot;&lt;div class=\&quot;text\&quot;&gt;Some text&lt;/div&gt;&quot;

# bad (no double-quotes)
%(This is #{quality} style)
# should be &quot;This is #{quality} style&quot;

# bad (multiple lines)
%(&lt;div&gt;\n&lt;span class=&quot;big&quot;&gt;#{exclamation}&lt;/span&gt;\n&lt;/div&gt;)
# should be a heredoc.

# good (requires interpolation, has quotes, single line)
%(&lt;tr&gt;&lt;td class=&quot;name&quot;&gt;#{name}&lt;/td&gt;)</code></pre>
</li>

<li>
<p>当<code>\</code>匹配不止一个时 ，使用<code>%r</code></p>

<pre><code># bad
%r(\s+)

# still bad
%r(^/(.*)$)
# should be /^\/(.*)$/

# good
%r(^/blog/2011/(.*)$)</code></pre>
</li>
</ul>

<h2 id="_11">哈希</h2>
<hr />
<ul>
<li>
<p>使用<code>=&gt;</code>作为哈希的键值表示方式</p>

<pre><code># bad
user = {
  login: &quot;defunkt&quot;,
  name: &quot;Chris Wanstrath&quot;
}

# bad
user = {
  login: &quot;defunkt&quot;,
  name: &quot;Chris Wanstrath&quot;,
  &quot;followers-count&quot; =&gt; 52390235
}

# good
user = {
  :login =&gt; &quot;defunkt&quot;,
  :name =&gt; &quot;Chris Wanstrath&quot;,
  &quot;followers-count&quot; =&gt; 52390235
}</code></pre>
</li>
</ul>
                
            </div>

        </article>


        <article class="home">

            <span class="post-date">
                
                February
                2nd,
                  
                2014
            </span>

            <h2>
                <a href="http://www.xuzou.me/writing/2014/02/02/writing-articles-using-markdown.html">使用Markdown写文章</a>
            </h2>

            <div>
                
                  <h3 id="_markdown">关于 Markdown</h3>

<p><img src="/images/markdown.png" alt="markdown" /> <br />使用特定标点符号作为有意义和格式的标识符，通过Markdown渲染引擎，生成html文件，呈现有样式的文章。非常适合作为一种书写语言。</p>

<h3 id="markdwon_">Markdwon 语法</h3>

<h4 id="">段落</h4>

<p>回车：行末尾两个或两个以上的空格</p>

<h4 id="_2">标题</h4>

<ol>
<li>
<p>Setext形式是用底线的形式，利用=（第一标题）和-（第二标题），</p>
</li>

<li>
<p>Atx形式则是在行首插入1至6個#，对应到6阶标题： <br /> # 这是 H1 <br /> ## 这是 H2 <br /> ###### 这是 H6</p>
</li>
</ol>

<h4 id="_3">清单</h4>

<ol>
<li>
<p>无编号方式</p>

<ul>
<li>Red</li>

<li>Green</li>

<li>Blue</li>
</ul>
</li>

<li>
<p>有编号方式</p>

<ol>
<li>Bird</li>

<li>McHale</li>

<li>Parish</li>
</ol>
</li>
</ol>

<h4 id="_4">超链接</h4>

<pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.

[This link](http://example.net/) has no title attribute.</code></pre>

<h4 id="_5">图片</h4>

<pre><code>![Alt text](/path/to/img.jpg)</code></pre>
                
            </div>

        </article>


        <article class="home">

            <span class="post-date">
                
                February
                2nd,
                  
                2014
            </span>

            <h2>
                <a href="http://www.xuzou.me/coding/git/2014/02/02/git-vs-svn.html">git vs svn</a>
            </h2>

            <div>
                
                  <p>git 发展于linux的代码管理，自身带有浓烈的黑客色彩。git的分布式代码管理和简易的分支管理，正是敏捷开发所寻找的快步小走的模式。</p>

<h3 id="_vs_">分布式 vs 集中式</h3>

<p>git 的版本管理模式是分布式的，在每个本地版本（克隆版本）保存了代码库的完整版本信息，方便离线工作。这样可以很方便的进行分支的提交和同步。 <br />svn 的版本管理模式是集中式，只有在服务器上保存了代码库的完整信息</p>

<h3 id="">不同的分支管理模式</h3>

<p>git 分支是轻量的分支，在各个分支切换十分方便，分支与主支在同一目录下，可以方便的查看分支的状态 <br />svn 的分支基本是在与主支（trunk）不同的目录（branchs）下,切换繁琐</p>
                
            </div>

        </article>

<hr/>

<ul class="pager"> 

  
    <li class="previous disabled">
      <a>&larr; Newer</a>
    </li>
  
  
  <li>
          <span class="page_number">Page: 1 of 1</span>
  </li>

  
    <li class="next disabled">
            <a>Older &rarr;</a>        
    </li>
  

</ul>




			<!-- footer.html -->
<footer>
 <hr/>
 <p>
 	&copy; 2015 xuzou with Jekyll. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
 </p>
</footer>

<!-- footer.html end -->


		</div>

    
	<script type="text/javascript" src="http://www.xuzou.me/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.xuzou.me/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="http://www.xuzou.me/assets/js/app.js"></script>
   </body>

</html>


